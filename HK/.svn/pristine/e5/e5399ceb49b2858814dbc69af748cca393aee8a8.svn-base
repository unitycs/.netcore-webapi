using System;
using System.Threading.Tasks;
using General.Core;
using General.Core.Data;
using General.Core.Extension;
using General.EntityFrameworkCore.Log;

namespace General.Api.Core.Log
{
    public class LogManage
    {

        /// <summary>
        /// 记录日志
        /// </summary>
        public static void ApiLog(ApiLog log, ApiLogRepositoryType type = ApiLogRepositoryType.ApiLog)
        {
            log.CreationTime = DateTime.Now;
            log.OprNo = log.OprNo ?? "";
            log.LogType = LogTypeEnum.ApiRequest.GetHashCode().ToString();
            log.LogName = typeof(LogTypeEnum).GetEnumDescription(LogTypeEnum.ApiRequest.GetHashCode());
            Task.Run(() =>
            {
                switch (type)
                {
                    case ApiLogRepositoryType.ApiLog: LogContext.ApiLogRepository.Insert(log); break;
                    case ApiLogRepositoryType.Exception: LogContext.ExceptionApiLogRepository.Insert(log); break;
                    case ApiLogRepositoryType.Resource: LogContext.ResourceApiLogRepository.Insert(log); break;
                    default: LogContext.ApiLogRepository.Insert(log); break;
                }
                //LogContext.ApiLogRepository.Insert(log);
            });
        }


    }
}